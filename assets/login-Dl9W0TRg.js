import{u as J,t as X,n as $,m as N,e as me,c as Q,a as ze,r as De,i as T,I as q,w as p,b as Oe,d as be,F as ve,p as Y,g as Fe,f as Ne,s as qe,h as je,j as We,k as Ze,l as se,o as Ge,q as ce,v as He,x as Ue,y as Ke,z as Je,C as Ye,A as Xe,B as Qe,_ as pe,D as et,E as tt,G as nt,H as at,J as G}from"./main-DMTYnL0o.js";import{g as he,d as ee,f as s,b as lt,r as j,c as R,w as it,n as H,m as rt,H as ye,v as ae,p as ot,F as st,e as ct,o as ut,D as z,E as ue,u as U,G as K,X as dt}from"./vue-DNnLlXmC.js";let ft=0;function gt(){const e=he(),{name:n="unknown"}=(e==null?void 0:e.type)||{};return`${n}-${++ft}`}const[mt,D]=Q("cell"),Se={tag:N("div"),icon:String,size:String,title:$,value:$,label:$,center:Boolean,isLink:Boolean,border:X,iconPrefix:String,valueClass:J,labelClass:J,titleClass:J,titleStyle:null,arrowDirection:String,required:{type:[Boolean,String],default:null},clickable:{type:Boolean,default:null}},bt=me({},Se,De);var vt=ee({name:mt,props:bt,setup(e,{slots:n}){const l=ze(),c=()=>{if(n.label||T(e.label))return s("div",{class:[D("label"),e.labelClass]},[n.label?n.label():e.label])},r=()=>{var d;if(n.title||T(e.title)){const h=(d=n.title)==null?void 0:d.call(n);return Array.isArray(h)&&h.length===0?void 0:s("div",{class:[D("title"),e.titleClass],style:e.titleStyle},[h||s("span",null,[e.title]),c()])}},f=()=>{const d=n.value||n.default;if(d||T(e.value))return s("div",{class:[D("value"),e.valueClass]},[d?d():s("span",null,[e.value])])},V=()=>{if(n.icon)return n.icon();if(e.icon)return s(q,{name:e.icon,class:D("left-icon"),classPrefix:e.iconPrefix},null)},B=()=>{if(n["right-icon"])return n["right-icon"]();if(e.isLink){const d=e.arrowDirection&&e.arrowDirection!=="right"?`arrow-${e.arrowDirection}`:"arrow";return s(q,{name:d,class:D("right-icon")},null)}};return()=>{var d;const{tag:h,size:g,center:A,border:y,isLink:v,required:C}=e,x=(d=e.clickable)!=null?d:v,a={center:A,required:!!C,clickable:x,borderless:!y};return g&&(a[g]=!!g),s(h,{class:D(a),role:x?"button":void 0,tabindex:x?0:void 0,onClick:l},{default:()=>{var u;return[V(),r(),f(),B(),(u=n.extra)==null?void 0:u.call(n)]}})}}});const ht=p(vt),[yt,St]=Q("form"),_t={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:$,labelAlign:String,inputAlign:String,scrollToError:Boolean,scrollToErrorPosition:String,validateFirst:Boolean,submitOnEnter:X,showErrorMessage:X,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var wt=ee({name:yt,props:_t,emits:["submit","failed"],setup(e,{emit:n,slots:l}){const{children:c,linkChildren:r}=Oe(ve),f=a=>a?c.filter(u=>a.includes(u.name)):c,V=a=>new Promise((u,m)=>{const w=[];f(a).reduce((te,O)=>te.then(()=>{if(!w.length)return O.validate().then(F=>{F&&w.push(F)})}),Promise.resolve()).then(()=>{w.length?m(w):u()})}),B=a=>new Promise((u,m)=>{const w=f(a);Promise.all(w.map(_=>_.validate())).then(_=>{_=_.filter(Boolean),_.length?m(_):u()})}),d=a=>{const u=c.find(m=>m.name===a);return u?new Promise((m,w)=>{u.validate().then(_=>{_?w(_):m()})}):Promise.reject()},h=a=>typeof a=="string"?d(a):e.validateFirst?V(a):B(a),g=a=>{typeof a=="string"&&(a=[a]),f(a).forEach(m=>{m.resetValidation()})},A=()=>c.reduce((a,u)=>(a[u.name]=u.getValidationStatus(),a),{}),y=(a,u)=>{c.some(m=>m.name===a?(m.$el.scrollIntoView(u),!0):!1)},v=()=>c.reduce((a,u)=>(u.name!==void 0&&(a[u.name]=u.formValue.value),a),{}),C=()=>{const a=v();h().then(()=>n("submit",a)).catch(u=>{n("failed",{values:a,errors:u});const{scrollToError:m,scrollToErrorPosition:w}=e;m&&u[0].name&&y(u[0].name,w?{block:w}:void 0)})},x=a=>{Y(a),C()};return r({props:e}),be({submit:C,validate:h,getValues:v,scrollToField:y,resetValidation:g,getValidationStatus:A}),()=>{var a;return s("form",{class:St(),onSubmit:x},[(a=l.default)==null?void 0:a.call(l)])}}});const Vt=p(wt);function _e(e){return Array.isArray(e)?!e.length:e===0?!1:!e}function xt(e,n){if(_e(e)){if(n.required)return!1;if(n.validateEmpty===!1)return!0}return!(n.pattern&&!n.pattern.test(String(e)))}function kt(e,n){return new Promise(l=>{const c=n.validator(e,n);if(We(c)){c.then(l);return}l(c)})}function de(e,n){const{message:l}=n;return je(l)?l(e,n):l||""}function Ct({target:e}){e.composing=!0}function fe({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function Et(e,n){const l=Fe();e.style.height="auto";let c=e.scrollHeight;if(Ne(n)){const{maxHeight:r,minHeight:f}=n;r!==void 0&&(c=Math.min(c,r)),f!==void 0&&(c=Math.max(c,f))}c&&(e.style.height=`${c}px`,qe(l))}function It(e,n){return e==="number"&&(e="text",n??(n="decimal")),e==="digit"&&(e="tel",n??(n="numeric")),{type:e,inputmode:n}}function P(e){return[...e].length}function ne(e,n){return[...e].slice(0,n).join("")}const[Bt,k]=Q("field"),Pt={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:$,max:Number,min:Number,formatter:Function,clearIcon:N("clear"),modelValue:Ke(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:N("focus"),formatTrigger:N("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},inputmode:String},Tt=me({},Se,Pt,{rows:$,type:N("text"),rules:Array,autosize:[Boolean,Object],labelWidth:$,labelClass:J,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var At=ee({name:Bt,props:Tt,emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:n,slots:l}){const c=gt(),r=lt({status:"unvalidated",focused:!1,validateMessage:""}),f=j(),V=j(),B=j(),{parent:d}=Ze(ve),h=()=>{var t;return String((t=e.modelValue)!=null?t:"")},g=t=>{if(T(e[t]))return e[t];if(d&&T(d.props[t]))return d.props[t]},A=R(()=>{const t=g("readonly");if(e.clearable&&!t){const i=h()!=="",o=e.clearTrigger==="always"||e.clearTrigger==="focus"&&r.focused;return i&&o}return!1}),y=R(()=>B.value&&l.input?B.value():e.modelValue),v=R(()=>{var t;const i=g("required");return i==="auto"?(t=e.rules)==null?void 0:t.some(o=>o.required):i}),C=t=>t.reduce((i,o)=>i.then(()=>{if(r.status==="failed")return;let{value:b}=y;if(o.formatter&&(b=o.formatter(b,o)),!xt(b,o)){r.status="failed",r.validateMessage=de(b,o);return}if(o.validator)return _e(b)&&o.validateEmpty===!1?void 0:kt(b,o).then(S=>{S&&typeof S=="string"?(r.status="failed",r.validateMessage=S):S===!1&&(r.status="failed",r.validateMessage=de(b,o))})}),Promise.resolve()),x=()=>{r.status="unvalidated",r.validateMessage=""},a=()=>n("endValidate",{status:r.status,message:r.validateMessage}),u=(t=e.rules)=>new Promise(i=>{x(),t?(n("startValidate"),C(t).then(()=>{r.status==="failed"?(i({name:e.name,message:r.validateMessage}),a()):(r.status="passed",i(),a())})):i()}),m=t=>{if(d&&e.rules){const{validateTrigger:i}=d.props,o=ce(i).includes(t),b=e.rules.filter(S=>S.trigger?ce(S.trigger).includes(t):o);b.length&&u(b)}},w=t=>{var i;const{maxlength:o}=e;if(T(o)&&P(t)>+o){const b=h();if(b&&P(b)===+o)return b;const S=(i=f.value)==null?void 0:i.selectionEnd;if(r.focused&&S){const L=[...t],M=L.length-+o;return L.splice(S-M,M),L.join("")}return ne(t,+o)}return t},_=(t,i="onChange")=>{var o,b;const S=t;t=w(t);const L=P(S)-P(t);if(e.type==="number"||e.type==="digit"){const I=e.type==="number";if(t=He(t,I,I),i==="onBlur"&&t!==""&&(e.min!==void 0||e.max!==void 0)){const E=Ue(+t,(o=e.min)!=null?o:-1/0,(b=e.max)!=null?b:1/0);+t!==E&&(t=E.toString())}}let M=0;if(e.formatter&&i===e.formatTrigger){const{formatter:I,maxlength:E}=e;if(t=I(t),T(E)&&P(t)>+E&&(t=ne(t,+E)),f.value&&r.focused){const{selectionEnd:Z}=f.value,oe=ne(S,Z);M=P(I(oe))-P(oe)}}if(f.value&&f.value.value!==t)if(r.focused){let{selectionStart:I,selectionEnd:E}=f.value;if(f.value.value=t,T(I)&&T(E)){const Z=P(t);L?(I-=L,E-=L):M&&(I+=M,E+=M),f.value.setSelectionRange(Math.min(I,Z),Math.min(E,Z))}}else f.value.value=t;t!==e.modelValue&&n("update:modelValue",t)},te=t=>{t.target.composing||_(t.target.value)},O=()=>{var t;return(t=f.value)==null?void 0:t.blur()},F=()=>{var t;return(t=f.value)==null?void 0:t.focus()},W=()=>{const t=f.value;e.type==="textarea"&&e.autosize&&t&&Et(t,e.autosize)},we=t=>{r.focused=!0,n("focus",t),H(W),g("readonly")&&O()},Ve=t=>{r.focused=!1,_(h(),"onBlur"),n("blur",t),!g("readonly")&&(m("onBlur"),H(W),Je())},le=t=>n("clickInput",t),xe=t=>n("clickLeftIcon",t),ke=t=>n("clickRightIcon",t),Ce=t=>{Y(t),n("update:modelValue",""),n("clear",t)},ie=R(()=>{if(typeof e.error=="boolean")return e.error;if(d&&d.props.showError&&r.status==="failed")return!0}),Ee=R(()=>{const t=g("labelWidth"),i=g("labelAlign");if(t&&i!=="top")return{width:se(t)}}),Ie=t=>{t.keyCode===13&&(!(d&&d.props.submitOnEnter)&&e.type!=="textarea"&&Y(t),e.type==="search"&&O()),n("keypress",t)},re=()=>e.id||`${c}-input`,Be=()=>r.status,Pe=()=>{const t=k("control",[g("inputAlign"),{error:ie.value,custom:!!l.input,"min-height":e.type==="textarea"&&!e.autosize}]);if(l.input)return s("div",{class:t,onClick:le},[l.input()]);const i={id:re(),ref:f,name:e.name,rows:e.rows!==void 0?+e.rows:void 0,class:t,disabled:g("disabled"),readonly:g("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,autocapitalize:e.autocapitalize,autocorrect:e.autocorrect,enterkeyhint:e.enterkeyhint,spellcheck:e.spellcheck,"aria-labelledby":e.label?`${c}-label`:void 0,"data-allow-mismatch":"attribute",onBlur:Ve,onFocus:we,onInput:te,onClick:le,onChange:fe,onKeypress:Ie,onCompositionend:fe,onCompositionstart:Ct};return e.type==="textarea"?s("textarea",ae(i,{inputmode:e.inputmode}),null):s("input",ae(It(e.type,e.inputmode),i),null)},Te=()=>{const t=l["left-icon"];if(e.leftIcon||t)return s("div",{class:k("left-icon"),onClick:xe},[t?t():s(q,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])},Ae=()=>{const t=l["right-icon"];if(e.rightIcon||t)return s("div",{class:k("right-icon"),onClick:ke},[t?t():s(q,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},Le=()=>{if(e.showWordLimit&&e.maxlength){const t=P(h());return s("div",{class:k("word-limit")},[s("span",{class:k("word-num")},[t]),ye("/"),e.maxlength])}},Me=()=>{if(d&&d.props.showErrorMessage===!1)return;const t=e.errorMessage||r.validateMessage;if(t){const i=l["error-message"],o=g("errorMessageAlign");return s("div",{class:k("error-message",o)},[i?i({message:t}):t])}},$e=()=>{const t=g("labelWidth"),i=g("labelAlign"),o=g("colon")?":":"";if(l.label)return[l.label(),o];if(e.label)return s("label",{id:`${c}-label`,for:l.input?void 0:re(),"data-allow-mismatch":"attribute",onClick:b=>{Y(b),F()},style:i==="top"&&t?{width:se(t)}:void 0},[e.label+o])},Re=()=>[s("div",{class:k("body")},[Pe(),A.value&&s(q,{ref:V,name:e.clearIcon,class:k("clear")},null),Ae(),l.button&&s("div",{class:k("button")},[l.button()])]),Le(),Me()];return be({blur:O,focus:F,validate:u,formValue:y,resetValidation:x,getValidationStatus:Be}),ot(Ye,{customValue:B,resetValidation:x,validateWithTrigger:m}),it(()=>e.modelValue,()=>{_(h()),x(),m("onChange"),H(W)}),rt(()=>{_(h(),e.formatTrigger),H(W)}),Ge("touchstart",Ce,{target:R(()=>{var t;return(t=V.value)==null?void 0:t.$el})}),()=>{const t=g("disabled"),i=g("labelAlign"),o=Te(),b=()=>{const S=$e();return i==="top"?[o,S].filter(Boolean):S||[]};return s(ht,{size:e.size,class:k({error:ie.value,disabled:t,[`label-${i}`]:i}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:Ee.value,valueClass:k("value"),titleClass:[k("label",[i,{required:v.value}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:o&&i!=="top"?()=>o:null,title:b,value:Re,extra:l.extra})}}});const Lt=p(At),[Mt,ge]=Q("cell-group"),$t={title:String,inset:Boolean,border:X};var Rt=ee({name:Mt,inheritAttrs:!1,props:$t,setup(e,{slots:n,attrs:l}){const c=()=>{var f;return s("div",ae({class:[ge({inset:e.inset}),{[Qe]:e.border&&!e.inset}]},l,Xe()),[(f=n.default)==null?void 0:f.call(n)])},r=()=>s("div",{class:ge("title",{inset:e.inset})},[n.title?n.title():e.title]);return()=>e.title||n.title?s(st,null,[r(),c()]):c()}});const zt=p(Rt),Dt={class:"login"},Ot={class:"warp"},Ft={class:"title"},Nt={style:{margin:"16px"}},qt={__name:"login",setup(e){const n=et(),{$t:l}=he().proxy,c=j(!1),r=tt(),f=nt(),V=j({email:"",password:""}),B=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,d=/^((?=.*[A-Za-z])(?=.*\d)|(?=.*[A-Za-z])(?=.*[!@#$%^&*()_+\-\=])|(?=.*\d)(?=.*[!@#$%^&*()_+\-\=]))[A-Za-z\d!@#$%^&*()_+\-\=]{8,}$/,h=y=>{if(!B.test(y))return"邮箱格式错误"},g=y=>{if(y===""||!d.test(y))return"密码格式错误"},A=y=>{if(y.password==="")return G("password cannot be empty");if(y.email==="")return G("Email cannot be empty");try{if(n.toLogin(y)){G(l("login.loginSuccess"));let C=f.query.redirect||"/";r.push(C,500)}}catch(v){v.indexOf("Email already exists")!=-1&&(V.value.password=""),G(v),console.error(v)}};return(y,v)=>{const C=Lt,x=zt,a=at,u=Vt;return ut(),ct("div",Dt,[z("div",Ot,[z("p",Ft,ue(U(l)("login.loginLabel")),1),z("div",null,[s(u,{onSubmit:A},{default:K(()=>[s(x,{inset:""},{default:K(()=>[s(C,{modelValue:V.value.email,"onUpdate:modelValue":v[0]||(v[0]=m=>V.value.email=m),label:U(l)("login.emailLabel"),name:"email",rules:[{validator:h}],"label-align":"top"},null,8,["modelValue","label","rules"]),s(C,{modelValue:V.value.password,"onUpdate:modelValue":v[2]||(v[2]=m=>V.value.password=m),type:c.value?"text":"password",name:"password",label:U(l)("login.passwordLabel"),rules:[{validator:g}],"label-align":"top"},{button:K(()=>[z("div",{onClick:v[1]||(v[1]=m=>c.value=!c.value)},[z("i",{class:dt(["iconfont",c.value?"icon-kejian":"icon-yanjing-guan"])},null,2)])]),_:1},8,["modelValue","type","label","rules"])]),_:1}),z("div",Nt,[s(a,{round:"",block:"",type:"primary","native-type":"submit"},{default:K(()=>[ye(ue(U(l)("login.submitBut")),1)]),_:1})])]),_:1})])])])}}},Zt=pe(qt,[["__scopeId","data-v-607c1a40"]]);export{Zt as default};
